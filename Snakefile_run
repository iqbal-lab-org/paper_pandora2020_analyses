from pathlib import Path
configfile: "config.yaml"
output_dir = Path(config["pipeline_output"])


rule all:
    input:
        output_dir / "pangenome_variations/output_pangenome_variations_pandora_paper_tag1",
        output_dir / "subsampler/output_subsampler_pandora_paper_tag1",
        output_dir / "pandora_analysis_pipeline/pandora_output_pandora_paper_tag1",
        output_dir / "variant_callers_pipeline/output_other_variant_callers_pandora_paper_tag1"


rule run_pangenome_variations:
    output:
        directory(output_dir / "pangenome_variations/output_pangenome_variations_pandora_paper_tag1")
    threads: 1
    resources:
        mem_mb=16000
    shell:
        """
        cd {output_dir}/pangenome_variations && \
        source venv/bin/activate && \
        bash scripts/submit_lsf.sh --configfile config.pandora_paper_tag1.yaml
        """


rule run_subsampler:
    output:
        directory(output_dir / "subsampler/output_subsampler_pandora_paper_tag1")
    threads: 1
    resources:
        mem_mb=16000
    shell:
        """
        cd {output_dir}/subsampler && \
        source venv/bin/activate && \
        bash scripts/submit_lsf.sh --configfile config.pandora_paper_tag1.yaml
        """


rule run_pandora_analysis_pipeline:
    input:
        rules.run_subsampler.output
    output:
        directory(output_dir / "pandora_analysis_pipeline/pandora_output_pandora_paper_tag1")
    threads: 16
    resources:
        mem_mb=32000
    shell:
        """
        cd {output_dir}/pandora_analysis_pipeline && \
        source venv/bin/activate && \
        bash scripts/submit_lsf.sh --configfile config.pandora_paper_tag1.yaml
        """


rule run_variant_callers_pipeline:
    input:
        rules.run_subsampler.output
    output:
        directory(output_dir / "variant_callers_pipeline/output_other_variant_callers_pandora_paper_tag1")
    threads: 16
    resources:
        mem_mb=32000
    shell:
        """
        cd {output_dir}/variant_callers_pipeline && \
        source venv/bin/activate && \
        bash scripts/submit_lsf.sh --configfile config.pandora_paper_tag1.yaml
        """
